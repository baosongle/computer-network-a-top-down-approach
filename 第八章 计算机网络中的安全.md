# 第八章 计算机网络中的安全

计算机网络中的两个节点希望安全通信，需要具有以下的特性

- **机密性**。这说明通信的内容只有发送方和接收方才能知道，窃听者截获报文后也无法理解报文的内容
- **报文完整性**。发送方和接收方希望报文在传输过程中没有被篡改
- **端点鉴别**。发送方和接收方都能确定另一方的确有其声称的身份
- **运行安全性**。能够连接到互联网的主机，都希望不会因为恶意者的攻击而瘫痪

## 密码学原理
要达到安全通信中的机密性，就需要对传输的报文加密。被加密的报文称为 **明文（plaintext，clear text）**；使用 **加密算法（encryption algorithm）** 可以加密明文得到 **密文（ciphertext）**；在加密的过程中需要使用 **密钥（key）**；如果需要把密文重新转成明文，就需要用到 **解密算法（decryption algorithm）**；类似的，解密算法也需要解密密钥。在对称加密中，加密密钥和解密密钥是相同的；而在公开密钥系统中，加密和解密的密钥是不同的，且加密密钥是公开的

### 凯撒密码

凯撒密码是以罗马共和国执政官尤里乌斯·凯撒的名字命名的一种加密技术，原理非常简单：对于一个明文输入，将明文中的字母替换成另一个字母。每一种替换规则就是一个密钥

凯撒密码有一个重要缺陷，即相同的明文字母对应同一个密文字母，因此可以用统计分析的方式去破解密码。比如英文中字母 e 出现的频率大约是 13%，而字母 t 出现的频率是 19%，而且英文单词 the 出现的概率也特别高，这样就能统计密文中字母或单词出现的频率来估算加密的密钥

如果尝试攻击凯撒密码，根据攻击者所拥有的信息，可以把攻击方法分为下面 3 种

- **唯密文攻击**：攻击者只知道密文，这时可以使用对字母频率的统计分析来攻击凯撒密码
- **已知明文攻击**：攻击者知道明文中一定会出现一些单词，根据这些单词的密文来攻击凯撒密码
- **选择明文攻击**：攻击者能够得到一些明文对应的密文，从而展开攻击。这与已知明文攻击有些类似

针对这几种攻击，后来发展出了 **多码代替密码（polyalphabetic encryption）** 技术，这种技术尝试用多个凯撒密码密钥去加密一段密文

### 块密码

**块密码**  是对称加密的一种方法，它将明文分为 k 比特的块，将每一个块映射为另一个块，映射的结果就是密文，每一种映射就是一个密钥。对于 k 比特的块，共有 `(2^k)!` 种密钥。当 k 的值比较大时（如 k = 64），保存 `(2^k)!` 个映射关系的成本太高了，因此实际应用中会使用函数模拟的方式生成随机排列表，使得输入一个 k 比特的明文得到 k 比特密文，这个函数必须要有一个性质：明文的每一个比特位都能影响输出结果

目前 DES（Data Encryption Standard）、3DES 和 AES（Advanced Encryption Standard）都是块密码

实际上块密码与凯撒密码有些相似的地方，他们都是把明文替换成密文的方式，因此也会具有与凯撒密码相同的弱点，即相同的明文得到相同的密文。消除这个弱点的方式是在加密的过程中引入随机性。

一个可行的方法是：将明文分为 k 比特的明文快，对于每个明文快 mi，产生一个随机的 k 比特块 ri，那么密文 `ci = Ks(mi xor ri)`，其中 xor 是异或操作，Ks 是以 s 为密钥的加密函数。由于每一个明文快对应的随机块 ri 是不一样的，因此相同的明文块会产生不同的密文块

这个方法也有一个问题：传输的数据量变成了原来的两倍。因为现在不仅仅需要传输密文，还需要传输随机块 ri。为了解决这个问题，产生了一种称作 **密码块链接（Cipher Block Chaining，CBC）** 的技术。它的原理是：仅仅产生第一个明文块的随机块，加密得到第一个密文块后，这个密文块就作为下一个明文块的随机块。

## 公开密钥加密

上面的凯撒密码和块密码都是被称为对称加密的技术，这意味着加密方和解密方需要使用同一个密钥来加密和解密。对称加密引入了一个新的问题：双方该如何安全的共享密钥。在现代的计算机网络中，发送方和接收方是无法在线下见面并确定密钥的

为了解决这个问题，一种被称为 **公开密钥加密** 的技术被发明出来。公开密钥加密技术使用两个密钥，一个被称为 **公钥（public key）**，一个被称为 **私钥（private key）**。公钥是公开的，并且每个人都能知道，而私钥需要保密。公开密钥加密算法有这样一个性质：使用公钥加密明文得到密文，可以使用私钥解密；使用私钥加密明文得到密文，可以使用公钥解密。因此当两个人，比如 Bob 和 Alice 想要通信时，Bob 先获取到 Alice 的公钥，使用公钥加密后把密文发送给 Alice，Alice 得到密文后就能用私钥解密得到明文了；同理，Alice 也能获取到 Bob 的公钥并加密明文，Bob 用自己的私钥解密。当攻击者截取到密文后，因为没有私钥，也就不能解密密文了。

公开密钥加密算法需要面临两个问题

1. 攻击者可以使用选择明文攻击。因为公钥和加密算法是众所周知的，攻击者可以用任意明文生成密文，并以此展开攻击，公开密钥加密必须能防止攻击者以猜出私钥
2. 接收方无法得知密文是谁发送的。在共享密钥中，接收方收到密文后就能知道发送方是谁了，因为只有发送方能有密钥去加密。现在因为公钥和加密算法是公开的，任何一个人都能向接收方发送一段密文，因此接收方必须使用其他方法去确定发送方的身份

RSA 是现在比较流行的公开密钥加密算法，它基于的原理是目前没有高效的算法可以对大整数做因数分解。它的工作方式我就不说了，因为我也看不懂

## 报文完整性和数字签名

Bob 在收到一个来自于声称自己是 Alice 的人的报文时，他需要做下面两件事

1. 确定报文确实来自于 Alice
2. 确定报文在传输过程中没有收到篡改

在讨论这两点之前，我们还需要学习有关 **散列函数** 的知识